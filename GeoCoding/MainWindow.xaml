<Controls:MetroWindow x:Class="GeoCoding.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:GeoCoding"
        mc:Ignorable="d" xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        Title="MainWindow" Height="800" Width="1400" BorderBrush="{DynamicResource AccentColorBrush}" 
        BorderThickness="1" xmlns:Dialog="clr-namespace:MahApps.Metro.Controls.Dialogs;assembly=MahApps.Metro"
        Dialog:DialogParticipation.Register="{Binding}">
    <Controls:MetroWindow.DataContext>
        <local:MainWindowViewModel/>
    </Controls:MetroWindow.DataContext>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>

            <TabControl Grid.Column="0" Height="150" Controls:TabControlHelper.Underlined="TabItems">
                <TabItem Header="Файлы">
                    <Border>
                        <Grid Margin="5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="5"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" 
                                    BorderBrush="{DynamicResource AccentColorBrush}"  
                                    Padding="5"
                                    BorderThickness="1">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBox  Grid.Row="0" 
                                              VerticalAlignment="Center" 
                                              IsReadOnly="True" 
                                              Text="{Binding Files.FileInput, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Controls:TextBoxHelper.Watermark="Выбрать файл с данными" />
                                    <TextBlock Style="{StaticResource TextBlockFolder}">
                                        <TextBlock.InputBindings>
                                            <MouseBinding Command="{Binding CommandOpenFolder}" CommandParameter="{Binding Files.FileInput}" MouseAction="LeftClick"/>
                                        </TextBlock.InputBindings>
                                    </TextBlock>
                                    <Button  
                                        Grid.Row="1" 
                                        Content="Выбрать файл с данными" 
                                        Margin="5" 
                                        Padding="5" 
                                        VerticalAlignment="Top" 
                                        HorizontalAlignment="Right" 
                                        Command="{Binding CommandGetFile}"/>
                                    <Button  
                                        Grid.Row="1" 
                                        Content="Получить данные" 
                                        Margin="5" 
                                        Padding="5" 
                                        HorizontalAlignment="Left" 
                                        Command="{Binding CommandGetDataFromFile}"/>
                                </Grid>
                            </Border>
                            <Border Grid.Column="2" BorderBrush="{DynamicResource AccentColorBrush}" Padding="5"
        BorderThickness="1">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBox Grid.Row="0" 
                                             VerticalAlignment="Center" 
                                             IsReadOnly="True" 
                                             Text="{Binding Files.FileOutput, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                             Controls:TextBoxHelper.Watermark="Выбрать файл для сохранения" />
                                    <TextBlock Style="{StaticResource TextBlockFolder}">
                                        <TextBlock.InputBindings>
                                            <MouseBinding Command="{Binding CommandOpenFolder}" CommandParameter="{Binding Files.FileOutput}" MouseAction="LeftClick"/>
                                        </TextBlock.InputBindings>
                                    </TextBlock>

                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Button Grid.Column="0"
                                            Content="Выбрать файл для сохранения" 
                                            Margin="5" 
                                            Padding="5" VerticalAlignment="Top" 
                                           
                                            Command="{Binding CommandSetFileOutput}"/>
                                        <StackPanel Orientation="Vertical" Grid.Column="1" Margin="5">
                                            <CheckBox  IsEnabled="False" IsChecked="{Binding Files.CanCopyFileOutputToFtp, UpdateSourceTrigger=PropertyChanged}"
                                              Content="Так же скопировать данный файл на FTP-сервер" 
                                              VerticalAlignment="Center"
                                              ToolTip="После сохранения файла на локальном диске, файл будет скопирован на FTP-сервер (если он настроен на вкладке FTP)" />
                                            <StackPanel Orientation="Horizontal" ToolTip="Разбить выходной файл на части (по количеству строк), 0 - без разбиения">
                                                <CheckBox 
                                                    Content="Разбить файл на части (по строкам):" IsEnabled="False"
                                                    IsChecked="{Binding Files.CanBreakFileOutput, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                                <TextBox 
                                                    Width="80" 
                                                    IsEnabled="{Binding Files.CanBreakFileOutput}" 
                                                    Margin="5,0,0,0" 
                                                    Text="{Binding Files.MaxSizePart, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                                            </StackPanel>

                                        </StackPanel>
                                        <Button Grid.Column="2"
                                            Content="Сохранить данные" 
                                            Margin="5" 
                                            Padding="5" 
                                            Command="{Binding CommandSaveData}"/>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>
                    </Border>
                </TabItem>
                <TabItem Header="БД" IsEnabled="False">
                    <Border BorderBrush="{DynamicResource AccentColorBrush}" BorderThickness="1">

                    </Border>
                </TabItem>
                <TabItem Header="FTP" IsEnabled="False">
                    <Border BorderBrush="{DynamicResource AccentColorBrush}" BorderThickness="1">

                    </Border>
                </TabItem>
            </TabControl>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>

            <TabControl Grid.Column="0">
                <TabItem Header="Данные">
                    <DataGrid ItemsSource="{Binding CollectionGeoCod}" Style="{StaticResource DataGridMain}">
                        <DataGrid.Columns>
                            <!--<DataGridTemplateColumn Header="GlobalID" SortMemberPath="GlobalID">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding GlobalID}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>-->
                            <DataGridTemplateColumn  SortMemberPath="Status">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Style="{StaticResource TextBlockStatus}" Tag="{Binding Status}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Адрес" SortMemberPath="Address">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Address}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Долгота">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Longitude}" HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Широта">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Latitude}" HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Вид объекта" SortMemberPath="Kind">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Kind}" HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Качество" SortMemberPath="Precision">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Precision}" HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Качество - Qcode" SortMemberPath="Qcode">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Qcode}" HorizontalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem>
                <TabItem Header="Ошибки"/>
            </TabControl>

            <Grid Grid.Column="1" Width="200">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="auto"/>
                </Grid.RowDefinitions>
                <GroupBox Header="Статистика" Margin="3">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Всего адресов:"/>
                        <TextBlock Grid.Column="2" Grid.Row="0" Text="{Binding CollectionGeoCod.Count}"/>
                    </Grid>
                </GroupBox>
                <Button Grid.Row="1" 
                        Margin="5" 
                        Padding="5" 
                        VerticalAlignment="Center" 
                        Height="80" 
                        FontSize="16" 
                        FontWeight="Bold">
                    <Button.Style>
                        <Style TargetType="{x:Type Button}" BasedOn="{StaticResource MetroButton}">
                            <Setter Property="Content" Value="Геокодировать"/>
                            <Setter Property="Command" Value="{Binding CommandGetAllGeoCod}"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsStartGeoCoding}" Value="True">
                                    <Setter Property="Content" Value="Стоп"/>
                                    <Setter Property="Command" Value="{Binding CommandStopGeoCoding}"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>
        </Grid>
    </Grid>
</Controls:MetroWindow>